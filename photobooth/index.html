<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Photobooth Web App</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .container {
      padding: 1rem;
      position: relative;
    }
    video,
    canvas {
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    #video {
      filter: none;
    }
    .overlay {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      pointer-events: none;
      z-index: 10;
    }
    .sticker {
      position: absolute;
      font-size: 40px;
      pointer-events: none;
    }
    .frame {
      border: 20px solid rgba(255, 255, 255, 0.8);
      border-radius: 12px;
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 640px;
      height: 480px;
      z-index: 5;
    }
    #effects,
    #stickers,
    #backgrounds,
    #frames {
      margin: 1rem 0;
    }
    button {
      margin: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #007bff;
      color: white;
    }
    #previewCanvas {
      display: none;
    }
    #error-message {
      color: red;
      margin-top: 1rem;
      font-weight: bold;
    }
    #countdown {
      font-size: 48px;
      color: red;
      font-weight: bold;
      position: absolute;
      top: 240px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“¸ Photobooth App</h1>
    <video id="video" width="640" height="480" autoplay muted playsinline></video>
    <canvas id="previewCanvas" width="640" height="480"></canvas>
    <div id="countdown"></div>
    <div class="overlay" id="liveStickers"></div>
    <div class="frame" id="photoFrame"></div>
    <div id="error-message"></div>

    <div id="effects">
      <h3>Camera Effects</h3>
      <button onclick="applyEffect('none')">Normal</button>
      <button onclick="applyEffect('grayscale(1)')">Grayscale</button>
      <button onclick="applyEffect('sepia(1)')">Sepia</button>
      <button onclick="applyEffect('invert(1)')">Invert</button>
      <button onclick="applyEffect('contrast(1.5) brightness(1.2)')">VSCO</button>
      <button onclick="applyEffect('hue-rotate(90deg) saturate(2)')">TikTok</button>
    </div>

    <div id="backgrounds">
      <h3>Backgrounds</h3>
      <button onclick="changeBackground('none')">None</button>
      <button onclick="changeBackground('beach')">ğŸ–ï¸ Beach</button>
      <button onclick="changeBackground('space')">ğŸŒŒ Space</button>
    </div>

    <div id="stickers">
      <h3>Stickers</h3>
      <button onclick="addLiveSticker('https://i.imgur.com/UYiroys.png')">ğŸ±</button>
      <button onclick="addLiveSticker('https://i.imgur.com/Qr44v1W.png')">ğŸ€</button>
      <button onclick="addLiveSticker('https://i.imgur.com/HMnMwfj.png')">ğŸ‘“</button>
    </div>

    <div id="frames">
      <h3>Photo Frames</h3>
      <button onclick="changeFrameColor('white')">Putih</button>
      <button onclick="changeFrameColor('pink')">Pink</button>
      <button onclick="changeFrameColor('transparent')">Tanpa Frame</button>
    </div>

    <div>
      <button onclick="startCollage(4)">ğŸ–¼ï¸ 2x2 Collage</button>
      <button onclick="startCollage(3)">ğŸ–¼ï¸ 1x3 Strip</button>
      <button onclick="startCountdown()">ğŸ“¸ Capture Photo</button>
      <button onclick="saveAsImage()">ğŸ’¾ Save as Image</button>
      <button onclick="saveAsPDF()">ğŸ“„ Save as PDF</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('previewCanvas');
    const ctx = canvas.getContext('2d');
    const liveStickers = document.getElementById('liveStickers');
    const countdown = document.getElementById('countdown');
    const frame = document.getElementById('photoFrame');
    const errorMessage = document.getElementById('error-message');
    let background = 'none';
    let collageMode = false;
    let collageCount = 0;
    let collageTotal = 0;
    let collageCanvas;
    let collageCtx;

    async function setupCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
      } catch (error) {
        errorMessage.textContent = 'Gagal mengakses kamera: ' + error.message;
      }
    }
    setupCamera();

    function applyEffect(cssFilter) {
      video.style.filter = cssFilter;
    }

    function changeBackground(bg) {
      background = bg;
    }

    function addLiveSticker(url) {
      const img = document.createElement('img');
      img.src = url;
      img.style.position = 'absolute';
      img.style.left = Math.random() * 550 + 'px';
      img.style.top = Math.random() * 400 + 'px';
      img.style.width = '60px';
      img.style.height = '60px';
      img.classList.add('sticker');
      liveStickers.appendChild(img);
    }

    function changeFrameColor(color) {
      frame.style.borderColor = color;
    }

    function startCountdown() {
      let count = 3;
      countdown.textContent = count;
      const interval = setInterval(() => {
        count--;
        countdown.textContent = count > 0 ? count : '';
        if (count === 0) {
          clearInterval(interval);
          takePhoto();
        }
      }, 1000);
    }

    function startCollage(total) {
      collageMode = true;
      collageTotal = total;
      collageCount = 0;
      collageCanvas = document.createElement('canvas');
      const cols = total === 4 ? 2 : 1;
      const rows = total === 4 ? 2 : total;
      collageCanvas.width = 640 * cols;
      collageCanvas.height = 480 * rows;
      collageCtx = collageCanvas.getContext('2d');
      captureCollage();
    }

    function captureCollage() {
      if (collageCount >= collageTotal) {
        const link = document.createElement('a');
        link.download = 'collage.png';
        link.href = collageCanvas.toDataURL();
        link.click();
        collageMode = false;
        return;
      }
      startCountdown();
    }

    function takePhoto() {
      if (!collageMode) canvas.style.display = 'block';
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      liveStickers.querySelectorAll('img').forEach(img => {
        const x = parseInt(img.style.left);
        const y = parseInt(img.style.top);
        ctx.drawImage(img, x, y, 60, 60);
      });

      if (collageMode) {
        const cols = collageTotal === 4 ? 2 : 1;
        const x = (collageCount % cols) * 640;
        const y = Math.floor(collageCount / cols) * 480;
        collageCtx.drawImage(canvas, x, y);
        collageCount++;
        setTimeout(captureCollage, 1000);
      }
    }

    function saveAsImage() {
      const link = document.createElement('a');
      link.download = 'photo.png';
      link.href = canvas.toDataURL();
      link.click();
    }

    function saveAsPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const imgData = canvas.toDataURL('image/png');
      pdf.addImage(imgData, 'PNG', 10, 10, 180, 135);
      pdf.save('photo.pdf');
    }
  </script>
</body>
</html>
