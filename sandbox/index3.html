<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>sandbox.atmax.id — Glass Cards + Supabase Sync</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.27.0"></script>
  <style>
    html, body { scroll-behavior:smooth; }
    .reveal{opacity:0;transform:translateY(14px);transition:opacity .6s ease,transform .6s ease}
    .reveal.in{opacity:1;transform:none}

    #cardsGrid.dim > article:not(.hovered){
      filter: blur(4px) brightness(1.06) saturate(0);
      transform: scale(.985);
      box-shadow: none !important;
      background: rgba(255,255,255,.62) !important;
      transition: all .28s ease;
    }
    #cardsGrid.dim > article:not(.hovered) .media > img,
    #cardsGrid.dim > article:not(.hovered) .media > video{ filter: grayscale(100%) saturate(0) brightness(.95); }

    dialog[open]{animation:fadeIn .18s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:none}}

    .glass{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(14px) saturate(1.2);
      -webkit-backdrop-filter: blur(14px) saturate(1.2);
      box-shadow: 0 10px 30px -10px rgba(0,0,0,.25);
    }

    .media > img, .media > video{ filter: none; transition: filter .25s; }

    .frost::before{
      content: ""; position: absolute; inset: 0; pointer-events: none;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(255,255,255,.22), transparent 40%),
                  radial-gradient(900px 700px at 120% 120%, rgba(255,255,255,.18), transparent 45%);
    }
  </style>
</head>
<body class="bg-neutral-50 text-slate-900 font-inter antialiased">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-neutral-50/70 backdrop-blur border-b">
    <div class="max-w-6xl mx-auto px-6 flex justify-between h-16 items-center">
      <a href="#" class="flex items-center gap-2 font-semibold">
        <img src="https://i.postimg.cc/8zrThQCL/im-curious-would-astrageldon-or-goozma-win-v0-5nqjpk8wb6uc1.gif" alt="logo" class="h-8 w-8 object-contain" loading="lazy" decoding="async" referrerpolicy="no-referrer">
        <span>sandbox.atmax.id</span>
      </a>
      <div class="flex items-center gap-2">
        <button id="btnSync" class="hidden md:inline-flex p-2 border rounded-full" aria-label="Sync" title="Sync">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5" fill="currentColor"><path d="M4 4v6h6M20 20v-6h-6"/><path d="M20 9A8 8 0 0 0 7 5M4 15a8 8 0 0 0 13 4"/></svg>
        </button>
        <button id="btnOpenLogin" class="hidden md:inline-flex px-4 py-2 bg-black text-white rounded-full">Login</button>
      </div>
    </div>
  </header>

  <!-- Admin bar -->
  <div id="adminBar" class="hidden sticky top-16 z-40 bg-indigo-600 text-white">
    <div class="max-w-6xl mx-auto px-6 py-2 flex gap-3 text-sm items-center">
      <span class="font-semibold">Mode Admin</span>
      <button id="btnAddCard" class="px-3 py-1 rounded-full bg-white/10 hover:bg-white/20 transition">+ Tambah Kotak</button>
      <button id="btnLogout" class="ms-auto px-3 py-1 rounded-full bg-white/10 hover:bg-white/20 transition">Logout</button>
    </div>
  </div>

  <!-- Cards -->
  <section id="bawah" class="py-10 md:py-16">
    <div class="max-w-6xl mx-auto px-6">
      <div id="cardsGrid" class="grid md:grid-cols-2 gap-8 min-h-[200px]"></div>
      <p id="emptyHint" class="hidden text-sm text-slate-500 text-center py-10">Data Not Synced..</p>
    </div>
  </section>

  <footer class="py-10 border-t">
    <div class="max-w-6xl mx-auto px-6 flex justify-between text-sm">
      <p>© 2025 sandbox.atmax.id.</p>
      <div class="flex gap-3"><a href="#">Kebijakan Privasi</a><a href="#">Kontak</a></div>
    </div>
  </footer>

  <!-- LOGIN MODAL -->
  <dialog id="loginModal" class="rounded-2xl w-full max-w-md backdrop:bg-black/40">
    <form method="dialog" class="p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Masuk Admin</h3>
        <button class="text-slate-500" value="close" aria-label="Tutup">✕</button>
      </div>
      <input id="adminCode" type="email" placeholder="Email Admin" class="w-full border p-2 mb-4 rounded" required>
      <div class="flex justify-end gap-2">
        <button value="close" class="px-3 py-2 rounded border">Batal</button>
        <button id="btnLogin" type="button" class="bg-black text-white px-4 py-2 rounded">Masuk</button>
      </div>
    </form>
  </dialog>

  <script>
    // ==== Supabase Setup ====
    const supabaseUrl = 'https://YOUR_PROJECT_REF.supabase.co';  // Ganti dengan URL Supabase kamu
    const supabaseKey = 'YOUR_PUBLIC_ANON_KEY';  // Ganti dengan public anon key Supabase kamu
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);  // Pastikan Supabase diinisialisasi terlebih dahulu

    let cards = [];
    let admin = sessionStorage.getItem('eventx_admin') === '1';
    const grid = document.getElementById('cardsGrid');
    const tpl = document.getElementById('cardTpl');
    const btnSync = document.getElementById('btnSync');
    const emptyHint = document.getElementById('emptyHint');
  
    // Fungsi login menggunakan Supabase Auth
    async function login() {
      const email = document.getElementById('adminCode').value;  // Menggunakan input adminCode sebagai email
      const password = 'your_admin_password';  // Password admin yang sudah kamu buat di Supabase

      const { user, session, error } = await supabase.auth.signInWithPassword({
        email: email,
        password: password,
      });

      if (error) {
        alert('Login failed: ' + error.message);
      } else {
        console.log('User logged in:', user);
        sessionStorage.setItem('eventx_admin', '1');
        render();  // Refresh render setelah login berhasil
        loginModal?.close();  // Menutup modal login setelah login berhasil
      }
    }

    // Menambahkan event listener untuk tombol login
    const btnLogin = document.getElementById('btnLogin');
    if (btnLogin) {
      btnLogin.addEventListener('click', async () => {
        await login();  // Panggil fungsi login
      });
    }

    // Menambahkan event listener untuk tombol login di header
    const btnOpenLogin = document.getElementById('btnOpenLogin');
    if (btnOpenLogin) {
      btnOpenLogin.addEventListener('click', () => {
        loginModal?.showModal();  // Menampilkan modal login
      });
    }

    // Ambil data dari Supabase
    async function remoteList() {
      const { data, error } = await supabase
        .from('cards')
        .select('*');
      if (error) {
        console.error('Error fetching data from Supabase:', error.message);
        return [];
      }
      return data;
    }

    // Simpan data ke Supabase
    async function remoteSaveAll() {
      const { data, error } = await supabase
        .from('cards')
        .upsert(cards, { onConflict: ['id'] });
      if (error) {
        console.error('Error saving data to Supabase:', error.message);
        return { ok: false };
      }
      return { ok: true, count: data.length };
    }

    // Render data
    function render() {
      grid.innerHTML = '';
      cards.forEach(c => {
        const node = tpl.content.cloneNode(true);
        const art = node.querySelector('article');
        const mediaHost = node.querySelector('.media');
        const colorLayer = node.querySelector('.colorLayer');
        if (colorLayer) colorLayer.style.background = c.bg || '#efefef';
        buildMedia(mediaHost, c.mediaType, c.mediaUrl);
        node.querySelector('.badge').textContent = c.category || '';
        renderIcon(node.querySelector('.icon'), c.icon);
        node.querySelector('.title').textContent = c.title || '';
        node.querySelector('.desc').textContent = c.desc || '';
        const btn = node.querySelector('.btn');
        if (btn) {
          btn.href = c.url || '#';
        }
        grid.appendChild(node);
      });
      if (emptyHint) emptyHint.classList.toggle('hidden', cards.length > 0);
    }

    // Initialize app
    async function init() {
      try {
        const data = await remoteList();
        if (Array.isArray(data)) {
          cards = data;
        }
      } catch (e) {
        console.error('Error during data fetching:', e.message);
      }
      render();
    }

    init();
  </script>
</body>
</html>
