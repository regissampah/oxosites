<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Obrolin - Voice Room + YouTube Sync</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>
    .speaking { background-color: #d1fae5; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">

  <div class="w-full max-w-md bg-white shadow-md rounded p-4 mb-4">
    <input id="roomId" class="w-full mb-2 p-2 border rounded" placeholder="Room ID" />
    <input id="roomPw" type="password" class="w-full mb-2 p-2 border rounded" placeholder="Password" />
    <input id="username" class="w-full mb-2 p-2 border rounded" placeholder="Nama Kamu" />
    <div class="flex gap-2">
      <button id="createBtn" class="flex-1 bg-blue-600 text-white p-2 rounded">Buat Room</button>
      <button id="joinBtn" class="flex-1 bg-green-600 text-white p-2 rounded">Gabung Room</button>
    </div>
  </div>

  <div id="participantContainer" class="hidden w-full max-w-md bg-white rounded shadow-md p-4">
    <ul id="roomList" class="mb-4 space-y-1 text-gray-700"></ul>
    <div class="flex justify-between mb-2">
      <button id="toggleMute" class="bg-gray-800 text-white px-3 py-1 rounded">ðŸ”Š Mute</button>
      <button id="leaveRoom" class="bg-red-500 text-white px-3 py-1 rounded">ðŸšª Keluar</button>
      <button id="shareBtn" class="bg-green-600 text-white px-3 py-1 rounded">ðŸ“¤ Share</button>
    </div>
  </div>

  <div id="ytContainer" class="hidden w-full max-w-md bg-white mt-4 rounded shadow-md p-4">
    <input id="youtubeUrl" class="w-full mb-2 p-2 border rounded" placeholder="Tempel Link YouTube" />
    <div id="youtubeControls" class="hidden flex gap-2 mb-2">
      <button onclick="shareYouTubeLink()" class="flex-1 bg-blue-500 text-white p-2 rounded">Putar</button>
      <button onclick="pauseYoutubeAll()" class="flex-1 bg-yellow-500 text-white p-2 rounded">Pause</button>
      <button onclick="resumeYoutubeAll()" class="flex-1 bg-green-500 text-white p-2 rounded">Lanjutkan</button>
      <button onclick="stopYoutubeAll()" class="flex-1 bg-red-600 text-white p-2 rounded">Stop</button>
    </div>
    <div class="flex items-center justify-between mb-2">
      <label for="volumeSlider" class="text-sm">Volume</label>
      <input type="range" id="volumeSlider" min="0" max="100" value="100" class="w-3/4">
    </div>
    <div id="ytPlayer"></div>
  </div>

  <div id="audioContainer" class="hidden"></div>

  <script>
    let player;
    let playerReady = false;

    window.onYouTubeIframeAPIReady = () => {
      player = new YT.Player('ytPlayer', {
        height: '180',
        width: '100%',
        videoId: '',
        playerVars: { 'autoplay': 0, 'controls': 1 },
        events: {
          'onReady': () => {
            playerReady = true;
            document.getElementById("volumeSlider").addEventListener("input", e => {
              const volume = parseInt(e.target.value);
              if (player && player.setVolume) {
                player.setVolume(volume);
              }
            });
          }
        }
      });
    };

    function shareYouTubeLink() {
      const url = document.getElementById("youtubeUrl").value.trim();
      const videoId = extractVideoId(url);
      if (playerReady && videoId) {
        player.loadVideoById(videoId);
        document.getElementById("youtubeControls").classList.remove("hidden");
      } else {
        alert("Link tidak valid atau player belum siap");
      }
    }

    function extractVideoId(url) {
      try {
        const urlObj = new URL(url);
        if (urlObj.hostname.includes("youtu.be")) {
          return urlObj.pathname.slice(1);
        } else if (urlObj.hostname.includes("youtube.com")) {
          return urlObj.searchParams.get("v");
        }
      } catch {
        return null;
      }
    }

    function pauseYoutubeAll() {
      if (playerReady) player.pauseVideo();
    }

    function resumeYoutubeAll() {
      if (playerReady) player.playVideo();
    }

    function stopYoutubeAll() {
      if (playerReady) player.stopVideo();
    }
  </script>
</body>
</html>
